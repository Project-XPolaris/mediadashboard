"use strict";(self.webpackChunkmediadashboard=self.webpackChunkmediadashboard||[]).push([[657],{24315:function(me,q,t){var _=t(6614),S=t(56453),ee=t(87906),se=t(47746),ie=t(92094),D=t(25030),V=t(16760),le=t(59496),L=t(90750),T=t(4637),m=["fieldProps","proFieldProps"],oe=["fieldProps","proFieldProps"],b="text",ue=function(v){var s=v.fieldProps,Z=v.proFieldProps,A=(0,ee.Z)(v,m);return(0,T.jsx)(L.Z,(0,S.Z)({valueType:b,fieldProps:s,filedConfig:{valueType:b},proFieldProps:Z},A))},z=function(v){var s=(0,se.Z)(v.open||!1,{value:v.open,onChange:v.onOpenChange}),Z=(0,_.Z)(s,2),A=Z[0],G=Z[1];return(0,T.jsx)(ie.Z.Item,{shouldUpdate:!0,noStyle:!0,children:function(B){var F,X=B.getFieldValue(v.name||[]);return(0,T.jsx)(D.Z,(0,S.Z)((0,S.Z)({getPopupContainer:function(g){return g&&g.parentNode?g.parentNode:g},onOpenChange:function(g){return G(g)},content:(0,T.jsxs)("div",{style:{padding:"4px 0"},children:[(F=v.statusRender)===null||F===void 0?void 0:F.call(v,X),v.strengthText?(0,T.jsx)("div",{style:{marginTop:10},children:(0,T.jsx)("span",{children:v.strengthText})}):null]}),overlayStyle:{width:240},placement:"rightTop"},v.popoverProps),{},{open:A,children:v.children}))}})},de=function(v){var s=v.fieldProps,Z=v.proFieldProps,A=(0,ee.Z)(v,oe),G=(0,le.useState)(!1),H=(0,_.Z)(G,2),B=H[0],F=H[1];return s!=null&&s.statusRender&&A.name?(0,T.jsx)(z,{name:A.name,statusRender:s==null?void 0:s.statusRender,popoverProps:s==null?void 0:s.popoverProps,strengthText:s==null?void 0:s.strengthText,open:B,onOpenChange:F,children:(0,T.jsx)("div",{children:(0,T.jsx)(L.Z,(0,S.Z)({valueType:"password",fieldProps:(0,S.Z)((0,S.Z)({},(0,V.Z)(s,["statusRender","popoverProps","strengthText"])),{},{onBlur:function(K){var g;s==null||(g=s.onBlur)===null||g===void 0||g.call(s,K),F(!1)},onClick:function(K){var g;s==null||(g=s.onClick)===null||g===void 0||g.call(s,K),F(!0)}}),proFieldProps:Z,filedConfig:{valueType:b}},A))})}):(0,T.jsx)(L.Z,(0,S.Z)({valueType:"password",fieldProps:s,proFieldProps:Z,filedConfig:{valueType:b}},A))},w=ue;w.Password=de,w.displayName="ProFormComponent",q.Z=w},94988:function(me,q,t){t.r(q),t.d(q,{default:function(){return Oe}});var _=t(26068),S=t.n(_),ee=t(87218),se=t(436),ie=t(24757),D=t(59496),V={cover:"cover___lY42f",edited:"edited___tApdr"},le=t(15558),L=t.n(le),T=t(90228),m=t.n(T),oe=t(87999),b=t.n(oe),ue=t(48305),z=t.n(ue),de=t(56456),w=t(18603),Y=t(85408),v=t(6843),s=t(51913),Z=t(24315),A=t(56885),G={cover:"cover___HImUM",uploadInput:"uploadInput___uimAc"},H=t(29406),B=t(93780),F=function(){var U=b()(m()().mark(function r(h){var i,n,a,u,c;return m()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return i=h.page,n=i===void 0?1:i,a=h.pageSize,u=a===void 0?20:a,c=h.search,j.abrupt("return",(0,B.C)("/artist",{method:"GET",params:{page:n,pageSize:u,search:c}}));case 2:case"end":return j.stop()}},r)}));return function(h){return U.apply(this,arguments)}}(),X=t(17052),K=t(15238),g=t(43448),ge=t(50468),ce=t(72741),fe=t(74839),re=t(78501),N={container:"container___Scudz",left:"left___WCKL0",right:"right___T53Df",cover:"cover___biap8",itemSelected:"itemSelected___rVyvg",itemCover:"itemCover___pvTqJ",itemNoCover:"itemNoCover___gAlpS",item:"item___Qe9Zv"},xe=function(){var U=b()(m()().mark(function r(h){return m()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",B.C.get("/meta/search/album",{params:{key:h}}));case 1:case"end":return n.stop()}},r)}));return function(h){return U.apply(this,arguments)}}(),je=function(){var U=b()(m()().mark(function r(h){return m()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",B.C.get("/meta/album",{params:h}));case 1:case"end":return n.stop()}},r)}));return function(h){return U.apply(this,arguments)}}(),Ce=t(32699),e=t(4637),Se=function(r){var h=r.open,i=r.onCancel,n=r.onOk,a=(0,D.useState)([]),u=z()(a,2),c=u[0],P=u[1],j=(0,D.useState)(),O=z()(j,2),y=O[0],te=O[1],ve=(0,D.useState)(),J=z()(ve,2),Q=J[0],ae=J[1],pe=function(){var k=b()(m()().mark(function p(I){var E,W;return m()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:E={},x.t0=I.source,x.next=x.t0==="MusicBrain"?4:x.t0==="NeteaseMusic"?6:7;break;case 4:return E.mbId=I.id,x.abrupt("break",7);case 6:E.nemId=I.id;case 7:return x.prev=7,x.next=10,je(E);case 10:W=x.sent,W.data&&ae(W.data),x.next=17;break;case 14:x.prev=14,x.t1=x.catch(7),K.ZP.error("fetch error");case 17:case"end":return x.stop()}},p,null,[[7,14]])}));return function(I){return k.apply(this,arguments)}}();(0,D.useEffect)(function(){y&&pe(y)},[y]);var he=function(){var k=b()(m()().mark(function p(I){var E;return m()().wrap(function($){for(;;)switch($.prev=$.next){case 0:return $.next=2,xe(I);case 2:E=$.sent,E.data&&P(E.data);case 4:case"end":return $.stop()}},p)}));return function(I){return k.apply(this,arguments)}}(),ne=function(){if(y){var p={name:y.name,artist:(0,Ce.isArray)(y.artists)?y.artists:[y.artists],cover:y.cover};n(p)}};return(0,e.jsxs)(g.Z,{open:h,width:"60vw",title:"Search album meta",onCancel:i,onOk:ne,children:[(0,e.jsx)(ge.Z.Search,{placeholder:"input search text",onSearch:he}),(0,e.jsx)(ce.Z,{}),(0,e.jsxs)("div",{className:N.container,children:[(0,e.jsx)("div",{className:N.left,children:(0,e.jsx)(fe.Z,{size:"small",dataSource:c,renderItem:function(p){return(0,e.jsx)(fe.Z.Item,{className:p.id===(y==null?void 0:y.id)?N.itemSelected:void 0,onClick:function(){te(p)},children:(0,e.jsxs)("div",{className:N.item,children:[p.cover?(0,e.jsx)("img",{src:p.cover,alt:p.name,className:N.itemCover}):(0,e.jsx)("div",{className:N.itemNoCover,children:"No cover"}),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{children:(0,e.jsx)(re.Z.Text,{strong:!0,children:p.name})}),(0,e.jsx)("div",{children:(0,e.jsx)(re.Z.Text,{children:p.artists})})]})]})},p.id)}})}),(0,e.jsx)("div",{className:N.right,children:Q&&(0,e.jsxs)("div",{children:[(0,e.jsx)("img",{className:N.cover,src:Q.cover,alt:""}),(0,e.jsx)("div",{children:(0,e.jsx)(re.Z.Text,{strong:!0,children:Q.name})}),(0,e.jsx)("div",{children:(0,e.jsx)(re.Z.Text,{children:Q.artist})})]})})]})]})},Pe=Se,Me=function(r){var h=r.title,i=r.open,n=r.onClose,a=r.artist,u=r.cover,c=r.album,P=r.track,j=r.onSave,O=r.tags,y=(0,D.useState)(!1),te=z()(y,2),ve=te[0],J=te[1],Q=function(){var M=b()(m()().mark(function l(d){var f;return m()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!(!d||d.length<2)){o.next=2;break}return o.abrupt("return");case 2:return o.next=4,F({search:d,page:1,pageSize:20});case 4:if(f=o.sent,!f.data){o.next=7;break}return o.abrupt("return",f.data);case 7:return o.abrupt("return",[]);case 8:case"end":return o.stop()}},l)}));return function(d){return M.apply(this,arguments)}}(),ae=(0,H.Z)(Q,{debounceWait:300,manual:!0}),pe=function(){var l,d,f,R=(l=(d=ae.data)===null||d===void 0?void 0:d.map(function(C){return C.name}))!==null&&l!==void 0?l:[],o=(f=a==null?void 0:a.filter(function(C){return!R.includes(C)}))!==null&&f!==void 0?f:[];return[].concat(L()(o),L()(R))},he=function(){var M=b()(m()().mark(function l(d){var f;return m()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!(!d||d.length<2)){o.next=2;break}return o.abrupt("return");case 2:return o.next=4,(0,X.M)({search:d,page:1,pageSize:20});case 4:if(f=o.sent,!f.data){o.next=7;break}return o.abrupt("return",f.data);case 7:return o.abrupt("return",[]);case 8:case"end":return o.stop()}},l)}));return function(d){return M.apply(this,arguments)}}(),ne=(0,H.Z)(he,{debounceWait:300,manual:!0}),k=function(){var l,d,f,R=(l=(d=ne.data)===null||d===void 0?void 0:d.map(function(C){return C.name}))!==null&&l!==void 0?l:[],o=(f=O==null?void 0:O.filter(function(C){return!R.includes(C)}))!==null&&f!==void 0?f:[];return[].concat(L()(o),L()(R))},p=(0,D.useRef)(),I=(0,D.useState)(),E=z()(I,2),W=E[0],$=E[1],x=function(l){$(l.target.files[0])},Ee=function(){n(),$(void 0)};return(0,e.jsxs)(de.Z,{title:h,width:720,open:i,onClose:Ee,extra:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(w.Z,{children:(0,e.jsx)(Y.ZP,{onClick:function(){return J(!0)},children:"Search Album"})}),(0,e.jsx)(w.Z,{children:(0,e.jsx)(Y.ZP,{onClick:function(){var l;j(S()(S()({},(l=p.current)===null||l===void 0?void 0:l.getFieldsValue()),{},{cover:W}))},children:"Save"})})]}),children:[(0,e.jsx)(Pe,{open:ve,onOk:function(){var M=b()(m()().mark(function l(d){var f,R;return m()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(f=p.current,f){C.next=3;break}return C.abrupt("return");case 3:if(f.setFieldsValue({artist:d.artist,album:d.name}),!d.cover){C.next=9;break}return C.next=7,fetch(d.cover).then(function(De){return De.blob()});case 7:R=C.sent,$(new File([R],"cover.jpg",{type:"image/jpeg"}));case 9:J(!1);case 10:case"end":return C.stop()}},l)}));return function(l){return M.apply(this,arguments)}}(),onCancel:function(){return J(!1)}}),i&&(0,e.jsxs)(v.A,{formRef:p,submitter:{render:function(l,d){return(0,e.jsx)("div",{})}},children:[(0,e.jsxs)(s.UW,{children:[(0,e.jsx)(Z.Z,{name:"title",label:"Title",initialValue:h,width:"xl"}),(0,e.jsx)(A.Z,{mode:"tags",name:"artist",label:"Artist",initialValue:a,width:"xl",showSearch:!0,options:pe(),fieldProps:{onSearch:function(l){ae.run(l)}}})]}),(0,e.jsxs)(s.UW,{title:"Album",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("img",{src:W?URL.createObjectURL(W):u,className:G.cover}),(0,e.jsx)("div",{children:(0,e.jsx)("input",{type:"file",onChange:x,className:G.uploadInput})})]}),(0,e.jsx)(Z.Z,{name:"album",label:"Album",initialValue:c,width:"xl"})]}),(0,e.jsxs)(s.UW,{title:"Meta",children:[(0,e.jsx)(Z.Z,{name:"track",label:"Track",initialValue:P}),(0,e.jsx)(A.Z,{mode:"tags",name:"tags",label:"Tags",initialValue:O,width:"xl",showSearch:!0,options:k(),fieldProps:{onSearch:function(l){ne.run(l)}}})]})]})]})},ye=Me,be=t(31734),Te=function(r){var h=r.open,i=r.total,n=r.current,a=r.name,u=r.success;return(0,e.jsxs)(g.Z,{open:h,footer:null,closable:!1,maskClosable:!1,title:"Updating",children:[(0,e.jsx)(be.Z,{percent:n/i*100,success:{percent:u/i*100}}),(0,e.jsx)("div",{children:a})]})},Ze=Te,Ae=function(){var r=(0,ie.useModel)("YouMusic.musicList");(0,D.useEffect)(function(){r.loadData({})},[]);var h=[{title:"cover",dataIndex:"id",key:"id",width:48,hideInSearch:!0,render:function(n,a){var u,c;return(u=a.album)!==null&&u!==void 0&&u.cover?(0,e.jsx)("img",{src:(c=a.editor)!==null&&c!==void 0&&c.coverFile?URL.createObjectURL(a.editor.coverFile):a.album.cover,className:V.cover}):(0,e.jsx)(e.Fragment,{})}},{title:"title",dataIndex:"title",key:"title",render:function(n,a){var u,c,P;return(0,e.jsx)("div",{className:(u=a.editor)!==null&&u!==void 0&&u.title?V.edited:void 0,children:(c=(P=a.editor)===null||P===void 0?void 0:P.title)!==null&&c!==void 0?c:a.title})}},{title:"Album",dataIndex:"album",key:"album",render:function(n,a){var u,c,P,j;return(0,e.jsx)("div",{className:(u=a.editor)!==null&&u!==void 0&&u.album?V.edited:void 0,children:(c=(P=a.editor)===null||P===void 0?void 0:P.album)!==null&&c!==void 0?c:(j=a.album)===null||j===void 0?void 0:j.name})}},{title:"Artist",dataIndex:"id",key:"artist",render:function(n,a){var u,c,P=(u=(c=a.editor)===null||c===void 0?void 0:c.artist)!==null&&u!==void 0?u:a.artist.map(function(j){return j.name});return P?P.map(function(j){var O;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("span",{className:(O=a.editor)!==null&&O!==void 0&&O.artist?V.edited:void 0,children:j}),(0,e.jsx)(ce.Z,{type:"vertical"})]})}):(0,e.jsx)(e.Fragment,{})}}];return(0,e.jsxs)(ee._z,{extra:(0,e.jsx)(e.Fragment,{children:r.hasEditedMusic()&&(0,e.jsx)(Y.ZP,{onClick:function(){return r.applyEdit()},children:"Save"})}),children:[(0,e.jsx)(ye,S()(S()({open:r.isEditorOpen,onClose:function(){return r.setIsEditorOpen(!1)}},r.getEditValues()),{},{onSave:function(n){r.updateValues(n)}})),(0,e.jsx)(Ze,{open:r.updateInfo.open,total:r.updateInfo.total,success:r.updateInfo.success,current:r.updateInfo.success+r.updateInfo.fail,name:r.updateInfo.name}),(0,e.jsx)(se.Z,{dataSource:r.musicList,columns:h,bordered:!1,size:"small",rowSelection:{onChange:function(n,a){r.setContextMusics(a)},selectedRowKeys:r.contextMusics.map(function(i){return i.id})},toolbar:{},tableAlertOptionRender:function(n){return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("a",{onClick:function(){return r.setIsEditorOpen(!0)},children:"Edit"}),(0,e.jsx)(ce.Z,{type:"vertical"}),(0,e.jsx)("a",{onClick:function(){return r.setContextMusics([])},children:"Clear all"})]})},pagination:{showQuickJumper:!0,total:r.pagination.total,current:r.pagination.page,pageSize:r.pagination.pageSize,pageSizeOptions:["10","20","50","100"],showSizeChanger:!0,defaultPageSize:50,onChange:function(n,a){r.loadData({page:S()(S()({},r.pagination),{},{page:n,pageSize:a})})}},onSubmit:function(n){r.loadData(S()({},n))},rowKey:function(n){return n.id}})]})},Oe=Ae}}]);

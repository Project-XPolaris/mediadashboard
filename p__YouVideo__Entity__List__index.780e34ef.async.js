"use strict";(self.webpackChunkmediadashboard=self.webpackChunkmediadashboard||[]).push([[429],{58307:function(Ze,H,t){t.r(H),t.d(H,{default:function(){return Pe}});var w=t(90228),Z=t.n(w),B=t(87999),O=t.n(B),Q=t(26068),y=t.n(Q),X=t(67825),J=t.n(X),q=t(48305),C=t.n(q),_=t(87218),ee=t(436),te=t(83280),ne=t(56885),K=t(24757),g=t(59496),G={cover:"cover___sGuQL",noCover:"noCover___Xwi7g",orderSelect:"orderSelect___AVMYR"},re=t(50468),R=t(15238),ae=t(43448),W=t(72741),Y=t(74839),A=t(78501),ie=t(50659),k=(0,ie.l7)({timeout:3e3,baseURL:"https://api.bgm.tv",headers:{"User-Agent":"allentom/YouVideo (https://github.com/Project-XPolaris/YouVideo)"}});k.interceptors.request.use(function(b,n){return b="https://api.bgm.tv"+b,{url:b,options:n}},{global:!1});var se=function(){var b=O()(Z()().mark(function n(c,v){return Z()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return console.log({key:c,type:v}),o.abrupt("return",k("/search/subject/".concat(c),{method:"GET",params:{type:v,responseGroup:"large"}}));case 2:case"end":return o.stop()}},n)}));return function(c,v){return b.apply(this,arguments)}}(),N={resultContainer:"resultContainer___WzYj2",resultList:"resultList___taHh7",itemContent:"itemContent___KjWvg",itemSelected:"itemSelected___i_m3m",itemCover:"itemCover___xFLOm",detail:"detail___t4SBP",detailSummary:"detailSummary___qyEev"},e=t(4637),le=re.Z.Search,oe=function(n){var c=n.visible,v=n.onCancel,E=n.type,o=n.onOk,I=(0,g.useState)([]),D=C()(I,2),S=D[0],d=D[1],j=(0,g.useState)(),m=C()(j,2),s=m[0],x=m[1],f=(0,g.useState)(!1),h=C()(f,2),L=h[0],l=h[1],a=function(){var u=O()(Z()().mark(function i(P){var p;return Z()().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:return l(!0),V.next=3,se(P,E);case 3:p=V.sent,l(!1),d(p.list),p!=null&&p.list&&(d(p.list),p.list.length>0&&x(p.list[0]));case 7:case"end":return V.stop()}},i)}));return function(P){return u.apply(this,arguments)}}(),r=function(){if(!s){R.ZP.error("Please select a subject");return}o(s)};return(0,e.jsxs)(ae.Z,{title:"Search subject",onCancel:v,visible:c,width:"60vw",onOk:r,children:[(0,e.jsx)(le,{placeholder:"input search text",onSearch:a,loading:L}),(0,e.jsx)(W.Z,{}),(0,e.jsxs)("div",{className:N.resultContainer,children:[(0,e.jsx)("div",{className:N.resultList,children:(0,e.jsx)(Y.Z,{dataSource:S,renderItem:function(i){return(0,e.jsx)(Y.Z.Item,{onClick:function(){return x(i)},className:i.id===(s==null?void 0:s.id)?N.itemSelected:void 0,children:(0,e.jsxs)("div",{className:N.itemContent,children:[(0,e.jsx)("img",{src:i.images.grid,className:N.itemCover}),(0,e.jsx)("div",{children:i.name})]})})}})}),(0,e.jsx)("div",{className:N.detail,children:s&&(0,e.jsxs)("div",{children:[(0,e.jsx)(A.Z.Title,{level:5,children:s.name}),(0,e.jsx)(A.Z.Title,{level:5,children:s.name_cn}),(0,e.jsx)("div",{className:N.detailSummary,children:s.summary})]})})]})]})},de=oe,ue=t(78566),ce=t(32232),ve=t(45347),me=t(35066),F=t(18603),he=t(4855),fe=t(21201),pe=t(44307),z=t(85408),ye=t(38593),ge=t(56456),Se=t(11167),je=function(){var n=(0,g.useState)(),c=C()(n,2),v=c[0],E=c[1],o=(0,g.useState)([]),I=C()(o,2),D=I[0],S=I[1],d=function(){var m=O()(Z()().mark(function s(x){var f,h,L;return Z()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return f=x.id,a.next=3,(0,Se.H8)(f);case 3:if(h=a.sent,h.success){a.next=7;break}return R.ZP.error(h.err),a.abrupt("return");case 7:if(L=h.data,L){a.next=11;break}return R.ZP.error("entity is null"),a.abrupt("return");case 11:E(L),S(L.videos.map(function(r){return y()({},r)}));case 13:case"end":return a.stop()}},s)}));return function(x){return m.apply(this,arguments)}}(),j=function(){return v?v.name:""};return{entity:v,loadData:d,getEntityName:j,setEntity:E,setEditableVideoList:S,editableVideoList:D}},xe=je,$=t(96584),M={epItem:"epItem___ewLgL",sectionHeader:"sectionHeader___TO05p",headerTitle:"headerTitle___RuTeR"},Ce=function(n){var c=n.id,v=n.open,E=n.onClose,o=xe();(0,g.useEffect)(function(){c&&o.loadData({id:c})},[c]);var I=function(d,j,m){var s=Array.from(d),x=s.splice(j,1),f=C()(x,1),h=f[0];return s.splice(m,0,h),s},D=function(d){if(d.destination){var j=I(o.editableVideoList,d.source.index,d.destination.index);o.setEditableVideoList(j)}};return(0,e.jsx)(ge.Z,{open:v,title:o.getEntityName(),onClose:E,children:(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:M.sectionHeader,children:[(0,e.jsx)("div",{className:M.headerTitle,children:"EP"}),(0,e.jsx)(z.ZP,{children:" save "})]}),(0,e.jsx)($.Z5,{onDragEnd:D,children:(0,e.jsx)($.bK,{droppableId:"droppable",children:function(d,j){return(0,e.jsxs)("div",y()(y()({},d.droppableProps),{},{ref:d.innerRef,children:[o.editableVideoList.map(function(m,s){return(0,e.jsx)($._l,{draggableId:m.id.toString(),index:s,children:function(f,h){return(0,e.jsx)("div",y()(y()(y()({ref:f.innerRef},f.draggableProps),f.dragHandleProps),{},{children:(0,e.jsx)("div",{className:M.epItem,children:m.name})}))}},m.id)}),d.placeholder]}))}})})]})})},be=Ce,Ee=["type","defaultRender","formItemProps","fieldProps"],De=function(){var n=(0,K.useModel)("YouVideo.entityList"),c=(0,g.useState)(!1),v=C()(c,2),E=v[0],o=v[1],I=(0,g.useState)(),D=C()(I,2),S=D[0],d=D[1],j=(0,g.useState)({open:!1}),m=C()(j,2),s=m[0],x=m[1];(0,g.useEffect)(function(){n.loadData({}),n.loadLibrary()},[]);var f=me.Z.useToken(),h=f.token.colorPrimary,L=[{title:"id",dataIndex:"id",key:"id",hideInSearch:!0},{title:"cover",dataIndex:"cover",key:"cover",hideInSearch:!0,render:function(a,r){return r.cover?(0,e.jsx)("img",{src:r.cover,className:G.cover}):(0,e.jsx)("div",{className:G.noCover,children:(0,e.jsx)(ue.Z,{})})},width:64},{title:"name",dataIndex:"name",key:"name",render:function(a,r){var u,i=((u=r.edit)===null||u===void 0?void 0:u.name)||r.name,P=r.edit!==void 0;return(0,e.jsxs)(F.Z,{children:[(0,e.jsx)(A.Z.Text,{style:{color:P?h:void 0},editable:{onChange:function(T){return n.setEditFieldValue(r.id,"name",T)}},onClick:function(){return K.history.push("/youvideo/Entity/detail?id=".concat(r.id))},children:i}),P&&(0,e.jsx)(ce.Z,{style:{color:h},onClick:function(){return n.setEditFieldValue(r.id,"name",void 0)}})]})}},{title:"Library",dataIndex:"libraryId",key:"library",render:function(a,r){var u=n.libraryList.find(function(i){return i.id===r.libraryId});return u?"".concat(u.name,"(").concat(u.id,")"):"unknown"},proFieldProps:{renderFormItem:function(a,r,u){var i=r.type,P=r.defaultRender,p=r.formItemProps,T=r.fieldProps,V=J()(r,Ee);return i==="form"?null:(0,e.jsx)(he.Z,y()(y()({},T),{},{options:n.libraryList.map(function(U){return{label:U.name,value:U.id}})}))}}},{title:"Action",dataIndex:"id",key:"action",hideInSearch:!0,render:function(a,r){var u=[{key:"1",label:"Bangumi",onClick:function(){d(r),o(!0)}}];return(0,e.jsx)(fe.Z,{overlay:(0,e.jsx)(pe.Z,{items:u}),children:(0,e.jsx)("a",{onClick:function(P){return P.preventDefault()},children:(0,e.jsxs)(F.Z,{children:["apply from source",(0,e.jsx)(ve.Z,{})]})})})}}];return(0,e.jsxs)(_._z,{children:[(0,e.jsx)(be,{id:s.id,open:s.open,onClose:function(){return x({open:!1})}}),(0,e.jsx)(de,{visible:E,onCancel:function(){return o(!1)},type:2,onOk:function(){var l=O()(Z()().mark(function a(r){return Z()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(S){i.next=2;break}return i.abrupt("return");case 2:return i.next=4,n.applyFromSource(S.id,"bangumi",String(r.id));case 4:o(!1);case 5:case"end":return i.stop()}},a)}));return function(a){return l.apply(this,arguments)}}()}),(0,e.jsx)(ee.Z,{dataSource:n.entityList,columns:L,pagination:{showQuickJumper:!0,total:n.pagination.total,current:n.pagination.page,pageSize:n.pagination.pageSize,pageSizeOptions:["10","20","50","100"],showSizeChanger:!0,defaultPageSize:50,onChange:function(a,r){n.loadData({page:y()(y()({},n.pagination),{},{page:a,pageSize:r})})}},onSubmit:function(a){n.updateFilter(a)},rowKey:function(a){return a.id},rowSelection:{selectedRowKeys:n.selectedEntity.map(function(l){return l.id}),onChange:function(a,r){n.setSelectedEntity(r)}},toolbar:{filter:(0,e.jsxs)(F.Z,{children:[(0,e.jsx)(te.M,{children:(0,e.jsx)(ne.Z,{name:"order",label:"Order",fieldProps:{dropdownMatchSelectWidth:!1,onChange:function(a){n.loadData({queryOrder:a})}},initialValue:n.order,allowClear:!1,valueEnum:{idasc:"ID Asc",iddesc:"ID Desc",nameasc:"Name Asc",namedesc:"Name Desc",createdasc:"Created Asc",createddesc:"Created Desc"}})}),(0,e.jsx)(W.Z,{}),n.hasChangeItem()&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(z.ZP,{type:"primary",onClick:n.saveChanges,children:"Save changes"}),(0,e.jsx)(z.ZP,{onClick:n.clearChanges,children:"Clear changes"})]})]})},tableAlertOptionRender:function(a){return(0,e.jsx)(ye.Z,{title:"Are you sure to delete these entities?",onConfirm:function(){return n.deleteSelected()},children:(0,e.jsx)("a",{children:"Delete"})})}})]})},Pe=De}}]);
